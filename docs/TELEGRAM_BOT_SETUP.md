# ü§ñ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –±–æ—Ç–∞

## –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞

1. **–ù–∞–π–¥–∏ @BotFather –≤ Telegram**
   - –û—Ç–∫—Ä–æ–π Telegram
   - –ù–∞–π–¥–∏ –±–æ—Ç–∞ `@BotFather`
   - –û—Ç–ø—Ä–∞–≤—å –∫–æ–º–∞–Ω–¥—É `/start`

2. **–°–æ–∑–¥–∞–π –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞**
   - –û—Ç–ø—Ä–∞–≤—å –∫–æ–º–∞–Ω–¥—É `/newbot`
   - –í–≤–µ–¥–∏ –∏–º—è –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `SatWave Bot`)
   - –í–≤–µ–¥–∏ username –±–æ—Ç–∞ (–¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ `bot`, –Ω–∞–ø—Ä–∏–º–µ—Ä: `satwave_analysis_bot`)

3. **–ü–æ–ª—É—á–∏ —Ç–æ–∫–µ–Ω**
   - BotFather –ø—Ä–∏—à–ª–µ—Ç —Ç–µ–±–µ —Ç–æ–∫–µ–Ω –≤–∏–¥–∞: `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`
   - **–í–ê–ñ–ù–û**: –ù–µ –¥–µ–ª–∏—Å—å —ç—Ç–∏–º —Ç–æ–∫–µ–Ω–æ–º –Ω–∏ —Å –∫–µ–º!

4. **–ù–∞—Å—Ç—Ä–æ–π –±–æ—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**
   ```
   /setdescription - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞
   /setabouttext - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç "–û –±–æ—Ç–µ"
   /setuserpic - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É
   /setcommands - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
   ```

   –ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥ –¥–ª—è `/setcommands`:
   ```
   start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å–±–æ—Ç–æ–º
   help - –ü–æ–ª—É—á–∏—Ç—å –ø–æ–º–æ—â—å
   stats - –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
   ```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ

1. **–°–∫–æ–ø–∏—Ä—É–π –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥–∞**
   ```bash
   cp .env.example .env
   ```

2. **–î–æ–±–∞–≤—å —Ç–æ–∫–µ–Ω –≤ .env**
   ```bash
   TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
   ```

3. **–ó–∞–ø—É—Å—Ç–∏ –±–æ—Ç–∞**
   
   –õ–æ–∫–∞–ª—å–Ω–æ:
   ```bash
   python -m satwave.adapters.bot.telegram_bot
   ```
   
   –ò–ª–∏ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É:
   ```bash
   satwave-bot
   ```
   
   –ß–µ—Ä–µ–∑ Docker:
   ```bash
   docker-compose up bot
   ```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞

### –ë–∞–∑–æ–≤—ã–π —Ñ–ª–æ—É

1. –ù–∞–π–¥–∏ —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å `/start`
3. –û—Ç–ø—Ä–∞–≤—å —Ñ–æ—Ç–æ –º—É—Å–æ—Ä–∞
4. –û—Ç–ø—Ä–∞–≤—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é (üìç —á–µ—Ä–µ–∑ —Å–∫—Ä–µ–ø–∫—É ‚Üí Location)
5. –ü–æ–ª—É—á–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞!

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–ª–æ—É

–ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–Ω–∞—á–∞–ª–∞ –ª–æ–∫–∞—Ü–∏—é, –ø–æ—Ç–æ–º —Ñ–æ—Ç–æ ‚Äî –ø–æ—Ä—è–¥–æ–∫ –Ω–µ –≤–∞–∂–µ–Ω.

### –ö–æ–º–∞–Ω–¥—ã

- `/start` ‚Äî –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- `/help` ‚Äî –ü–æ–¥—Ä–æ–±–Ω–∞—è –ø–æ–º–æ—â—å
- `/stats` ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (TODO)

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–æ—Ç–∞

```
src/satwave/adapters/bot/
‚îú‚îÄ‚îÄ telegram_bot.py    # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –±–æ—Ç–∞
‚îî‚îÄ‚îÄ handlers.py        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ—Ç–æ** ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **–ü–æ–ª—É—á–µ–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏** ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Å–µ—Å—Å–∏–∏
3. **–ö–æ–≥–¥–∞ –µ—Å—Ç—å –∏ —Ñ–æ—Ç–æ, –∏ –ª–æ–∫–∞—Ü–∏—è** ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è `PhotoAnalysisService`
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç** ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å —ç–º–æ–¥–∑–∏ –∏ –¥–µ—Ç–∞–ª—è–º–∏

### –°–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ—Å—Å–∏–π:
```python
user_sessions: dict[int, UserSession] = {}
```

**TODO –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞**: –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ Redis –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏.

## Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ —Ç–æ–∫–µ–Ω –≤ `.env`
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω (`python -m satwave.adapters.bot.telegram_bot`)
- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏: `LOG_LEVEL=DEBUG`

### –ë–æ—Ç –ø–æ–ª—É—á–∏–ª —Ñ–æ—Ç–æ, –Ω–æ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–ª
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è
- –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ª–æ–∫–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–∞—è (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö -90/90, -180/180)

### Duplicate location error
- –≠—Ç–∞ –ª–æ–∫–∞—Ü–∏—è —É–∂–µ –±—ã–ª–∞ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- –û—Ç–ø—Ä–∞–≤—å —Ñ–æ—Ç–æ –∏–∑ –¥—Ä—É–≥–æ–≥–æ –º–µ—Å—Ç–∞ (–¥–∞–ª—å—à–µ —á–µ–º 50 –º–µ—Ç—Ä–æ–≤)

## –ü—Ä–æ–¥–∞–∫—à–Ω —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π webhook –≤–º–µ—Å—Ç–æ polling**
   ```python
   # –í telegram_bot.py
   await self.dp.start_webhook(...)
   ```

2. **–î–æ–±–∞–≤—å Redis –¥–ª—è —Å–µ—Å—Å–∏–π**
   ```python
   from aiogram.fsm.storage.redis import RedisStorage
   storage = RedisStorage(redis)
   dp = Dispatcher(storage=storage)
   ```

3. **–î–æ–±–∞–≤—å rate limiting**
   ```python
   from aiogram.utils.chat_action import ChatActionMiddleware
   dp.message.middleware(ChatActionMiddleware())
   ```

4. **–õ–æ–≥–∏—Ä—É–π –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
   - –ö—Ç–æ, –∫–æ–≥–¥–∞, –æ—Ç–∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏–ª —Ñ–æ—Ç–æ
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

5. **–î–æ–±–∞–≤—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å**
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∞–Ω–∞–ª–∏–∑–∞–º
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫

